(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{112:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return i})),n.d(t,"metadata",(function(){return c})),n.d(t,"toc",(function(){return p})),n.d(t,"default",(function(){return b}));var a=n(3),o=n(7),r=(n(0),n(138)),i={subject:"TJV"},c={unversionedId:"bi-wsi-si-28/bi-wsi-si-28",id:"bi-wsi-si-28/bi-wsi-si-28",isDocsHomePage:!1,title:"bi-wsi-si-28",description:"JDBC Java Database Connectivity",source:"@site/topics/bi-wsi-si-28/bi-wsi-si-28.mdx",slug:"/bi-wsi-si-28/bi-wsi-si-28",permalink:"/szz-bootcamp/topics/bi-wsi-si-28/bi-wsi-si-28",version:"current",lastUpdatedBy:"Tomas Vosicky",sidebar:"someSidebar",previous:{title:"bi-wsi-si-27",permalink:"/szz-bootcamp/topics/bi-wsi-si-27/bi-wsi-si-27"},next:{title:"bi-wsi-si-29",permalink:"/szz-bootcamp/topics/bi-wsi-si-29/bi-wsi-si-29"}},p=[],s={toc:p};function b(e){var t=e.components,i=Object(o.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},s,i,{components:t,mdxType:"MDXLayout"}),Object(r.b)("h1",{id:"jdbc-java-database-connectivity"},"JDBC Java Database Connectivity"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Java rozhran\xed pro p\u0159ipojen\xed k rela\u010dn\xed datab\xe1zi")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Sou\u010d\xe1st\xed p\u0159\xedmo Java SE u\u017e od verze 1.1")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Umo\u017e\u0148uje vytvo\u0159it takzvan\xe9 spojen\xed (connection) s datab\xe1z\xed")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"P\u0159es toto spojen\xed lze pak spou\u0161t\u011bt dotazy SELECT, CREATE, INSERT,\nUPDATE a DELETE.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"JDBC je pouze obecn\xe9 rozhran\xed. Pro p\u0159ipojen\xed ke konkr\xe9tn\xedmu typu\ndatab\xe1ze (MySQL, PostgreSQL",".","...) je pot\u0159eba takzvan\xfd driver.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"JDBC Driver realizuje spojen\xed s konkr\xe9tn\xed datab\xe1z\xed \u2192 implementuje\nJDBC interface"))),Object(r.b)("p",null,Object(r.b)("img",{alt:"image",src:n(266).default}),'{width="95%"}'),Object(r.b)("h1",{id:"p\u0159ipojen\xed-se-k-db"},"P\u0159ipojen\xed se k DB"),Object(r.b)("p",null,"Nejd\u0159\xedve se k datab\xe1zi p\u0159ipoj\xedme (pozn.: try-with-resources funguje od\nJavy 7) pomoc\xed t\u0159\xeddy ",Object(r.b)("inlineCode",{parentName:"p"},"DriverManager"),"{.java}. P\u0159ed Javou 6 bylo t\u0159eba\nexplicitn\u011b definovat t\u0159\xeddu driveru a na\u010d\xedst ji."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),'try (Connection conn = DriverManager.getConnection(\n     "jdbc:mysql://localhost/mydb",\n     "myLogin",\n     "myPassword")) {\n\n  // zde pou\u017e\xedv\xe1me vytvo\u0159en\xe9 spojen\xed\n\n}  // Java VM se postar\xe1 o uzav\u0159en\xed spojen\xed\n')),Object(r.b)("p",null,"Vyu\u017eit\xed DriverManageru je vcelku nepraktick\xe9 (mus\xedme b\xfdt v try bloku), a\nproto vznikl DataSource. Jedn\xe1 se o interface, kter\xe1 vrac\xed stejnou\nConnection jako DriverManager. V\xfdvoj\xe1\u0159i DB mus\xed poskytovat konkr\xe9tn\xed\nimplementaci DataSource. Connection lze z\xedskat bez parametr\u016f nebo s\npomoc\xed dvojice ."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),'com.dbaccess.BasicDataSource ds = new com.dbaccess.BasicDataSource();\nds.setServerName("mujserver");\nds.setDatabaseName("mojedatabaze");\n\n// Metoda odstinena od konkretniho driveru \u2192 polymorfismus\npublic void doThings(DataSource ds) {\n  Connection con = ds.getConnection("user", "psswd");\n}\n')),Object(r.b)("p",null,"Detaily p\u0159ipojen\xed tak nemus\xed b\xfdt napevno v aplikaci. DriverManager d\xe1le\nnab\xedz\xed connection pooling (viz n\xed\u017ee)."),Object(r.b)("h1",{id:"pr\xe1ce-s-db"},"Pr\xe1ce s DB"),Object(r.b)("p",null,"P\u0159\xedkazy se vykon\xe1vaj\xed pomoc\xed t\u0159\xeddy Statement."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),"try (Statement stmt = conn.createStatement()) {\n  stmt.executeUpdate(\"INSERT INTO table VALUES ('neco')\");\n}\n")),Object(r.b)("p",null,"Existuje pak i PreparedStatement, do kter\xe9ho lze dod\xe1vat argumenty\ndynamicky."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),'try (PreparedStatement ps = conn.prepareStatement(\n     "SELECT * FROM person WHERE name = ? AND age = ?")\n) {\n    ps.setString(1, "Poor Yorick");\n    ps.setInt(2, 90);\n}\n')),Object(r.b)("p",null,"N\xe1vratov\xe1 hodnota je ",Object(r.b)("inlineCode",{parentName:"p"},"ResultSet"),"{.java}. Je to takov\xfd p\u0159evle\u010den\xfd\nn\xe1vrhov\xfd vzor ",Object(r.b)("inlineCode",{parentName:"p"},"Cursor ~ Iterator"),"{.java}. M\u016f\u017eeme s pomoc\xed n\u011bj iterovat\np\u0159es \u0159\xe1dky v\xfdsledk\u016f a podle index\u016f sloupce si sahat na jednotliv\xe9\nhodnoty."),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),'try (Statement stmt = conn.createStatement();\n     ResultSet rs = stmt.executeQuery("SELECT * FROM person")\n) {\n  while(rs.next()) {\n    String personName = rs.getString(1); // index sloupce\n    int personAge     = rs.getInt(2);\n  System.out.printf("Osoba: %s (%d)\\n", personName, personAge);\n  }\n}\n')),Object(r.b)("p",null,"D\xe1le lze pomoc\xed p\u0159\xedznak\u016f specifikovat, jestli iterace m\u016f\u017ee b\xfdt pouze\njednosm\u011brn\xe1 nebo oboustrann\xe1."),Object(r.b)("p",null,"Jeden p\u0159\xedkaz znamen\xe1 jeden atomick\xfd dotaz do datab\xe1ze. V r\xe1mci jedn\xe9\ntransakce lze ale vykonat v\xedce p\u0159\xedkaz\u016f. Ovliv\u0148uje to metoda\n",Object(r.b)("inlineCode",{parentName:"p"},"Connection#setAutoCommit(boolean)"),"{.java}. Pokud nastav\xedme autocommit\nna false, tak je pot\u0159eba transakci ru\u010dn\u011b odeslat -\n",Object(r.b)("inlineCode",{parentName:"p"},"Connection#commit()"),"{.java}."),Object(r.b)("p",null,Object(r.b)("img",{alt:"image",src:n(267).default}),'{width="95%"}'),Object(r.b)("h1",{id:"jdbc-connection-pooling"},"JDBC Connection pooling"),Object(r.b)("p",null,"Probl\xe9m - pro ka\u017ed\xe9 vykon\xe1n\xed dotazu je t\u0159eba se k datab\xe1zi p\u0159ipojit.\nP\u0159ipojen\xed stoj\xed n\u011bjak\xfd \u010das a nen\xed dobr\xe9 se neust\xe1le p\u0159ipojovat a\nodpojovat. Connection pooling zaji\u0161\u0165uje, \u017ee p\u0159ipojen\xed prob\u011bhne na\nza\u010d\xe1tku a zachov\xe1 se i po vykon\xe1n\xed dotazu. Pro dal\u0161\xed dotaz je existuj\xedc\xed\np\u0159ipojen\xed znovupou\u017eito."),Object(r.b)("p",null,"Connection pooling prob\xedh\xe1 v Jav\u011b automaticky, pokud je vyu\u017eit\n",Object(r.b)("inlineCode",{parentName:"p"},"DataSource"),"{.java}. Podpora mus\xed b\xfdt na stran\u011b implementace t\xe9to\n",Object(r.b)("inlineCode",{parentName:"p"},"interface"),"{.java}. JDBC 3.0 API Framework specifikuje sadu rozhran\xed,\nkter\xe9 mus\xed b\xfdt implementov\xe1ny."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"p"},"ConnectionPoolDataSource"),"{.java} - implementace od autor\u016f datab\xe1z\xed\nslou\u017e\xed jako factory, kter\xe1 vytv\xe1\u0159\xed PooledConnection")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"p"},"PooledConnection"),"{.java} - \u0159\xedd\xed p\u0159ipojen\xed k datab\xe1zi")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("inlineCode",{parentName:"p"},"ConnectionEventListener"),"{.java} - listener zm\u011bn v p\u0159ipojen\xedch k DB"))),Object(r.b)("p",null,"Nastaven\xed Connection poolu se v TJV d\u011blalo p\u0159es Glassfish. Na localhost\nwebu se zadaly p\u0159ihla\u0161ovac\xed \xfadaje do datab\xe1ze, adresa datab\xe1ze atp."),Object(r.b)("p",null,"Jak na to - viz video\n",Object(r.b)("a",Object(a.a)({parentName:"p"},{href:"https://youtu.be/f1z-3zlkXj8?t=2m27s"}),"https://youtu.be/f1z-3zlkXj8?t=2m27s ")),Object(r.b)("h1",{id:"jdbc-resource"},"JDBC Resource"),Object(r.b)("p",null,'Poskytuje prost\u0159edky pro p\u0159ipojen\xed k datab\xe1zi. Pro vytvo\u0159en\xed je pot\u0159eba\nspeficikovat Connection pool, se kter\xfdm bude spjat. M\xe1 vlastn\xed jm\xe9no\n(JNDI name), kter\xe9 dle konvence za\u010d\xedn\xe1 "jdbc/".'),Object(r.b)("p",null,"P\u0159\xedstup ke zdroji lze z\xedskat p\u0159es ",Object(r.b)("inlineCode",{parentName:"p"},"InitialContext"),"{.java}:"),Object(r.b)("pre",null,Object(r.b)("code",Object(a.a)({parentName:"pre"},{className:"language-java"}),'InitialContext ic = new InitialContext();\nDataSource source = (DataSource) ic.lookup("jdbc/my_resouce_name");\n')))}b.isMDXComponent=!0},138:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return m}));var a=n(0),o=n.n(a);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=o.a.createContext({}),b=function(e){var t=o.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},l=function(e){var t=b(e.components);return o.a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},j=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,i=e.parentName,s=p(e,["components","mdxType","originalType","parentName"]),l=b(n),j=a,m=l["".concat(i,".").concat(j)]||l[j]||u[j]||r;return n?o.a.createElement(m,c(c({ref:t},s),{},{components:n})):o.a.createElement(m,c({ref:t},s))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=j;var c={};for(var p in t)hasOwnProperty.call(t,p)&&(c[p]=t[p]);c.originalType=e,c.mdxType="string"==typeof e?e:a,i[1]=c;for(var s=2;s<r;s++)i[s]=n[s];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}j.displayName="MDXCreateElement"},266:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/image1-61b2d875ab116f17fa702a702c145427.png"},267:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/image2-cf37fef026473dade4ec9ddc9363c579.png"}}]);
<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<meta name="robots" content="noindex, nofollow">
<link rel="alternate" type="application/rss+xml" href="/szz-bootcamp/blog/rss.xml" title="SZZ Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/szz-bootcamp/blog/atom.xml" title="SZZ Blog Atom Feed">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous"><title data-react-helmet="true">bi-spol-16 | SZZ</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="bi-spol-16 | SZZ"><meta data-react-helmet="true" name="description" content="Procesy a vlákna"><meta data-react-helmet="true" property="og:description" content="Procesy a vlákna"><meta data-react-helmet="true" property="og:url" content="https://fit-szz.github.io/szz-bootcamp/topics/bi-spol-16/bi-spol-16"><link data-react-helmet="true" rel="shortcut icon" href="/szz-bootcamp/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://fit-szz.github.io/szz-bootcamp/topics/bi-spol-16/bi-spol-16"><link rel="stylesheet" href="/szz-bootcamp/styles.3237e005.css">
<link rel="preload" href="/szz-bootcamp/styles.00aaecf6.js" as="script">
<link rel="preload" href="/szz-bootcamp/runtime~main.52bf9769.js" as="script">
<link rel="preload" href="/szz-bootcamp/main.22fd2fa4.js" as="script">
<link rel="preload" href="/szz-bootcamp/1.07683b9e.js" as="script">
<link rel="preload" href="/szz-bootcamp/2.fa753fda.js" as="script">
<link rel="preload" href="/szz-bootcamp/69.d53fd8be.js" as="script">
<link rel="preload" href="/szz-bootcamp/70.b0f0a915.js" as="script">
<link rel="preload" href="/szz-bootcamp/935f2afb.dab50b01.js" as="script">
<link rel="preload" href="/szz-bootcamp/17896441.303e14c5.js" as="script">
<link rel="preload" href="/szz-bootcamp/77dc8558.215fe551.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/szz-bootcamp/"><strong class="navbar__title">SZZ</strong></a><a class="navbar__item navbar__link" href="/szz-bootcamp/topics/SPOL">SPOL</a><a class="navbar__item navbar__link" href="/szz-bootcamp/topics/WSI-SI">WSI-SI</a><a class="navbar__item navbar__link" href="/szz-bootcamp/topics/PI">PI</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/szz-bootcamp/"><strong class="navbar__title">SZZ</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/szz-bootcamp/topics/SPOL">SPOL</a></li><li class="menu__list-item"><a class="menu__link" href="/szz-bootcamp/topics/WSI-SI">WSI-SI</a></li><li class="menu__list-item"><a class="menu__link" href="/szz-bootcamp/topics/PI">PI</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_vMrn"><div class="docSidebarContainer_3Ak5" role="complementary"><div class="sidebar_3gvy"><div class="menu menu--responsive thin-scrollbar menu_1yIk"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_1CUI" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Intro</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/SPOL">SPOL</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/WSI-SI">WSI-SI</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/PI">PI</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Spol</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-01/bi-spol-01">bi-spol-01</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-02/bi-spol-02">bi-spol-02</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-04/bi-spol-04">bi-spol-04</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-05/bi-spol-05">bi-spol-05</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-06/bi-spol-06">bi-spol-06</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-07/bi-spol-07">bi-spol-07</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-08/bi-spol-08">bi-spol-08</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-09/bi-spol-09">bi-spol-09</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-10/bi-spol-10">bi-spol-10</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-11/bi-spol-11">bi-spol-11</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-12/bi-spol-12">bi-spol-12</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-13/bi-spol-13">bi-spol-13</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-14/bi-spol-14">bi-spol-14</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-15/bi-spol-15">bi-spol-15</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/szz-bootcamp/topics/bi-spol-16/bi-spol-16">bi-spol-16</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-18/bi-spol-18">bi-spol-18</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-22/bi-spol-22">bi-spol-22</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-23/bi-spol-23">bi-spol-23</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-24/bi-spol-24">bi-spol-24</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-27/bi-spol-27">bi-spol-27</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-28/bi-spol-28">bi-spol-28</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-29/bi-spol-29">bi-spol-29</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-30/bi-spol-30">bi-spol-30</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-31/bi-spol-31">bi-spol-31</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-32/bi-spol-32">bi-spol-32</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-33/bi-spol-33">bi-spol-33</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-34/bi-spol-34">bi-spol-34</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-35/bi-spol-35">bi-spol-35</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/szz-bootcamp/topics/bi-spol-36/bi-spol-36">bi-spol-36</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">WSI</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-01/bi-wsi-si-01">Informační bezpečnost, architektura bezpečnosti v modelu OSI.</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-02/bi-wsi-si-02">bi-wsi-si-02</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-03/bi-wsi-si-03">bi-wsi-si-03</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-04/bi-wsi-si-04">bi-wsi-si-04</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-05/bi-wsi-si-05">bi-wsi-si-05</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-06/bi-wsi-si-06">bi-wsi-si-06</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-07/bi-wsi-si-07">bi-wsi-si-07</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-08/bi-wsi-si-08">bi-wsi-si-08</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-09/bi-wsi-si-09">bi-wsi-si-09</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-10/bi-wsi-si-10">bi-wsi-si-10</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-13/bi-wsi-si-13">bi-wsi-si-13</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-14/bi-wsi-si-14">bi-wsi-si-14</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-15/bi-wsi-si-15">bi-wsi-si-15</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-16/bi-wsi-si-16">bi-wsi-si-16</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-17/bi-wsi-si-17">bi-wsi-si-17</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-18/bi-wsi-si-18">bi-wsi-si-18</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-19/bi-wsi-si-19">bi-wsi-si-19</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-20/bi-wsi-si-20">bi-wsi-si-20</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-22/bi-wsi-si-22">bi-wsi-si-22</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-23/bi-wsi-si-23">bi-wsi-si-23</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-24/bi-wsi-si-24">bi-wsi-si-24</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-25/bi-wsi-si-25">bi-wsi-si-25</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-26/bi-wsi-si-26">bi-wsi-si-26</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-27/bi-wsi-si-27">bi-wsi-si-27</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-28/bi-wsi-si-28">bi-wsi-si-28</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-29/bi-wsi-si-29">bi-wsi-si-29</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/szz-bootcamp/topics/bi-wsi-si-30/bi-wsi-si-30">bi-wsi-si-30</a></li></ul></li></ul></div></div></div><main class="docMainContainer_2iGs"><div class="container padding-vert--lg docItemWrapper_1bxp"><div class="row"><div class="col docItemCol_2AGf"><div class="docItemContainer_1tAC"><article><div class="admonition admonition-note alert alert--secondary"><div class="admonition-content"><span><strong>OSY():</strong> </span></div></div><header><h1 class="docTitle_cWlf">bi-spol-16</h1></header><div class="markdown"><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="procesy-a-vlákna"></a>Procesy a vlákna<a class="hash-link" href="#procesy-a-vlákna" title="Direct link to heading">#</a></h1><p><strong>Program</strong> je posloupnost instrukcí definujících chování procesu.</p><p><strong>Proces</strong> je instance spuštěného programu, která slouží k alokování
prostředků (adresový prostor, otevřené soubory, ... ). Informace o
tomto procesu (ID, identita, informace o rodiči a potomcích,...) jsou
následně uloženy v jádru.</p><p><strong>Vlákno</strong> je část výpočtu, které je přidělován procesor (jádro CPU).
Jádro alokuje pro každé vlákno zásobník (pro historii výpočtu a lokální
proměnné) a udržuje aktuální hodnoty registrů (pro opětovné spuštění)</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="procesy"></a>Procesy<a class="hash-link" href="#procesy" title="Direct link to heading">#</a></h2><p><strong>Vytvoření</strong></p><ul><li><p>OS inicializuje v jádře datové struktury spojené s novým procesem.</p></li><li><p>OS nahraje kód a data programu z disku do paměti a vytvoří prázdný
systémový zásobník pro main vlákno.</p></li></ul><p><strong>Klonovaní</strong></p><ul><li><p>OS zastaví aktuální proces a uloží jeho stav.</p></li><li><p>OS inicializuje v jádře datové struktury spojené s novým procesem.</p></li><li><p>OS udělá kopii aktuálního kódu, dat, zásobníku, stavu procesu,...</p></li></ul><p><strong>fork()</strong></p><ul><li><p>Vytvoří nový proces, který je kopií procesu, z kterého byla tato
funkce zavolána.</p></li><li><p>V rodičovském procesu vrací funkce PID potomka</p></li><li><p>V potomkovi vrací funkce 0</p></li><li><p>Kódový segment sdílí potomek s rodičem.</p></li><li><p>Datový a zásobníkový segment vznikají kopií dat a zásobníku rodiče.</p></li></ul><p><strong>execve(char *filename,...)</strong></p><ul><li><p>V procesu, ze kterého je funkce volána, spustí nový program.</p></li><li><p>Obsah původního procesu je přepsán novým programem.</p></li><li><p>Atributy procesu se nemění (PID, PPID, ...).</p></li></ul><p><strong>wait(int *status)</strong></p><ul><li><p>Umožňuje v rodičovském procesu počkat na dokončení potomka.</p></li><li><p>Funkce zablokuje rodičovský proces, ve kterém je zavolána, dokud se
jeden potomek neukončí.</p></li></ul><p><strong>Ukončení</strong></p><ul><li><p>Proces se pokusí předat návratový kód rodiči</p></li><li><p>Ukončení všech vláken, která existují v rámci procesu</p></li><li><p>Uvolnění aresového prostoru procesu a jeho datových struktu</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="vlákna"></a>Vlákna<a class="hash-link" href="#vlákna" title="Direct link to heading">#</a></h2><ul><li><p>Jsou jednotky plánované pro spuštění na CPU</p></li><li><p>Každé vlákno má vlastní:</p><ul><li><p>Hodnotu čítače instrukcí</p></li><li><p>Hodnotu CPU registrů</p></li><li><p>Zásobník</p></li></ul></li><li><p>Ostatní prostředky jsou sdílené</p></li><li><p>Vlákna nejsou nezávislá jako procesy</p></li><li><p>Vlákna sdílí stejný adresový prostor, stejné soubory, potomky a
reakce na signály</p></li></ul><p><img alt="image" src="/szz-bootcamp/assets/images/multitask-1c286c60f3d7cfcb35ac1ed866b8e08e.png">{width=&quot;.8\textwidth&quot;}</p><p><strong>Vytvoření</strong></p><ul><li><p>pthread_create() v POSIXu</p></li><li><p>CreateThread() v MS Win</p></li></ul><p><strong>Ukončení</strong></p><ul><li><p>pthread_exit() POSIX</p></li><li><p>ExitThread() MS Win</p></li></ul><p><strong>Přepínání kontextu</strong></p><ul><li><p>Rozdělení vláken jednotlivých procesů mezi jednotlivá jádra</p></li><li><p>Vlákno má svojí dobu, po kterou může běžet na daném jádře, pak je
prerušeno a je dán čas jinému vláknu</p></li></ul><p><img alt="image" src="/szz-bootcamp/assets/images/thread1-b2cd4cc27f2bc8abce0f52a8155ad07d.png">{width=&quot;.8\textwidth&quot;}</p><p><strong>Stavy vláken</strong></p><ul><li><p>Idle: vznik nového vlákna</p></li><li><p>Ready: vlákno čeká až mu bude přiďeleno jádro CPU</p></li><li><p>Running: vlákno je zpracováváno jádrem CPU</p></li><li><p>Blocked: vlákno čeká na událost (dokončení I/O operace, příchod
signálu,...)</p></li><li><p>Zombie: vlákno je ukončováno, ale zatím ještě nebylo vše dokončeno</p></li><li><p>Free: vlákno bylo kompletne zrušeno (pouze teoretický stav)</p></li></ul><p><img alt="image" src="/szz-bootcamp/assets/images/stavy-5aae6cf704d1ceeeac38e6e0e22445d1.png">{width=&quot;.8\textwidth&quot;}</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="synchronizace"></a>Synchronizace<a class="hash-link" href="#synchronizace" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="zákaz-přerušení-di"></a>Zákaz přerušení (DI)<a class="hash-link" href="#zákaz-přerušení-di" title="Direct link to heading">#</a></h2><p>CPU je přidělováno postupně jednotlivým vláknům za pomoci přerušení od
časovače nebo jiného přerušení. Vlákno zakáže všechna přerušení před
vstupem do kritické sekce a opět je povolí až po jejím opuštění.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="nevýhody"></a>Nevýhody<a class="hash-link" href="#nevýhody" title="Direct link to heading">#</a></h3><ul><li><p>DI od jednoho uživatele blokuje i ostatní</p></li><li><p>V multi-CPU má efekt pouze na aktuální CPU</p></li><li><p>Zpomalí reakce na přerušení</p></li><li><p>Možnost blokovat celé CPU při chybné implementaci</p></li><li><p>Nehodí se pro běžná uživatelská vlákna</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aktivní-čekání-vs-blokování"></a>Aktivní čekání vs blokování<a class="hash-link" href="#aktivní-čekání-vs-blokování" title="Direct link to heading">#</a></h2><p>Pouze jedno vlákno může do kritické sekce, ostatní mají smůlu</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="aktivní-čekání"></a>Aktivní čekání<a class="hash-link" href="#aktivní-čekání" title="Direct link to heading">#</a></h3><ul><li><p>Sdílená proměnná indikuje obsazenost</p></li><li><p>Vlákna ve smyčce testují tuto hodnotu a čekají až budou moci
postoupit</p></li><li><p>Pokud se dlouho čeká na vstup do kritické sekce, dochází k plýtvání
časem procesoru</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="blokování"></a>Blokování<a class="hash-link" href="#blokování" title="Direct link to heading">#</a></h3><p>Vlákno provede systémové volání, které ho zablokuje do okamžiku než se
sekce uvolní</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="sdílená-proměnná"></a>Sdílená proměnná<a class="hash-link" href="#sdílená-proměnná" title="Direct link to heading">#</a></h2><p>Vzájemné vyloučení nastavením sdílené proměnné při vstupu do sekce</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="instrukce-tsl"></a>Instrukce TSL<a class="hash-link" href="#instrukce-tsl" title="Direct link to heading">#</a></h2><ul><li><p>Test and Set Lock (TSL) - instrukce načte obsah slova do registru a
nastaví obsah slova na nenulovou hodnotu</p></li><li><p>CPU provádějící TSL lockne paměťovou sběrnici dokud se TSL nedokončí</p></li><li><p>TSL je atomická instrukce</p></li><li><p>TSL lze použít u multi-cpu se sdílenou pamětí</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="instrukce-xchg"></a>Instrukce XCHG<a class="hash-link" href="#instrukce-xchg" title="Direct link to heading">#</a></h2><ul><li><p>Alternativa k TSL</p></li><li><p>Exchange instrukce (XCHG) atomicky prohodí obsah slova na dané
adrese v paměti a registru</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="problémy"></a>Problémy<a class="hash-link" href="#problémy" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="bez-použití-synchronizace-časově-závislé-chyby"></a>Bez použití synchronizace (časově závislé chyby)<a class="hash-link" href="#bez-použití-synchronizace-časově-závislé-chyby" title="Direct link to heading">#</a></h3><ul><li><p>Dva a více procesů či vláken používá společné prostředky (sdílená
paměť, soubor, proměnná)</p></li><li><p>Výsledek je závislý na přepínání kontextu</p></li><li><p>Tyto chyby jsou velmi špatně detekovatelné</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="při-použití-synchronizace"></a>Při použití synchronizace<a class="hash-link" href="#při-použití-synchronizace" title="Direct link to heading">#</a></h3><ul><li><p>Deadlock = situace kdy se více vláken čeká na událost, kterou může
vyvolat pouze jedno z čekajících vláken</p></li><li><p>Livelock = situace, kdy několik vláken vykonává neužitečnou činnost
(mění svůj stav), ale nemohou postoupit k vykonávání usefull práce</p></li><li><p>Hladovění = situace, kdy ready vlákno je předbíháno a nedostane se k
prostředkům</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="inverzní-prioritní-problém"></a>Inverzní prioritní problém<a class="hash-link" href="#inverzní-prioritní-problém" title="Direct link to heading">#</a></h3><ul><li><p>Vlákno A má nižší prio. a je v kritické sekci</p></li><li><p>Vlákno B má vyšší prio. a čeká pomocí aktivního čekání</p></li><li><p>OS používá prioritní plánování, má 1 jádro na 1 CPU</p></li><li><p>Potom může nastat, je-li priorita fixní, uváznutí</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="synchronizace-pomocí-blokování"></a>Synchronizace pomocí blokování<a class="hash-link" href="#synchronizace-pomocí-blokování" title="Direct link to heading">#</a></h3><ul><li><p>Ve většina případů je blokování lepší než aktivní čekání či zákaz
přerušení</p></li><li><p>Vlákno je zablokováno, pokud chce vstoupit do již zablokované
kritické sekce, je přesunuto na čekací frontu</p></li><li><p>Tyto operace již na úrovni jádra OS</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="typy-synchronizace"></a>Typy synchronizace<a class="hash-link" href="#typy-synchronizace" title="Direct link to heading">#</a></h2><ul><li><p>Blokující send i receive - rendevous</p></li><li><p>Neblokující send a blokující receive</p></li><li><p>Neblokující send i receive + test příchozích zpráv</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="adresování"></a>Adresování<a class="hash-link" href="#adresování" title="Direct link to heading">#</a></h2><ul><li><p>Přímé - Zpráva je uložena přímo do prostoru příjemce</p></li><li><p>Nepřímé - Zpráva je uložena do sdíleného prostoru (mailbox)</p></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="přidělování-prostředků"></a>Přidělování prostředků<a class="hash-link" href="#přidělování-prostředků" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="sleep--wakeup"></a>Sleep &amp; Wakeup<a class="hash-link" href="#sleep--wakeup" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="wait"></a>wait()<a class="hash-link" href="#wait" title="Direct link to heading">#</a></h3><ul><li><p>Systémové volání</p></li><li><p>Zablokuje vlákno, které ho zavolalo</p></li><li><p>Zakáže alokaci CPU pro toto vlákno a přesune jej do fronty, kde čeká
na probuzení</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="wakeupthread"></a>wakeup(thread)<a class="hash-link" href="#wakeupthread" title="Direct link to heading">#</a></h3><ul><li><p>Probudí vlákno uspané pomocí wait()</p></li><li><p>Odstraní vlákno z čekací fronty</p></li><li><p>Povolí alokaci CPU</p></li><li><p>Waiting bit</p><ul><li><p>Wakeup volání na neuspané vlákno - bit je nastaven</p></li><li><p>Uspání vlákna s již nastaveným bitem - vlákno není uspáno, ale
bit je pouze resetován</p></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="condition-variable"></a>Condition variable<a class="hash-link" href="#condition-variable" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cond_waitvar-mutex"></a>cond_wait(&amp;var, &amp;mutex)<a class="hash-link" href="#cond_waitvar-mutex" title="Direct link to heading">#</a></h3><ul><li><p>Mutex zamčen a daném vláknu</p></li><li><p>Po zavolání je mutex odemčen a vlákno uspáno</p></li><li><p>Po probuzení je mutex znovu uzamčen</p></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="cond_signalvar"></a>cond_signal(&amp;var)<a class="hash-link" href="#cond_signalvar" title="Direct link to heading">#</a></h3><p>Odblokuje alespoň jedno z uspaných vláken</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="semafor"></a>Semafor<a class="hash-link" href="#semafor" title="Direct link to heading">#</a></h2><ul><li><p>Obsahuje čítač a frontu čekajících procesů</p></li><li><p>Instrukce jsou prováděny atomicky (nelze je přerušit)</p></li><li><p><strong>Init()</strong> Nastavení čítače na zadané číslo a vyprázdní se fronta</p></li><li><p><strong>Down()</strong> Pokud je čítač &gt; 0, sníží se o jedna. V opačném případě
je vlákno uloženo do fronty.</p></li><li><p><strong>Up()</strong> Pokud je fronta neprázdná, probudí se jedno z čekajících
vláken. V opačném případě se navýší čítač o jedna.</p></li><li><p><strong>Monitory</strong> Do bloku je vpuštěno vždy jen jedno vlákno O vyloučení
v rámci bloku se stará překladač nikoli programátor</p></li><li><p><strong>wait(c)</strong> Pozastaví vlákno na podmíněné proměnné c</p></li><li><p><strong>signal(c)</strong> Probudí jedno z pozastavených vláken</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="bariéry"></a>Bariéry<a class="hash-link" href="#bariéry" title="Direct link to heading">#</a></h2><p>Propouští minimální počet vláken. Když vlákna přijdou k bariéře, tak
čekají, dokud jich není minimální počet, a až poté jsou puštěny dál</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="coffmanovy-podmínky"></a>Coffmanovy podmínky<a class="hash-link" href="#coffmanovy-podmínky" title="Direct link to heading">#</a></h1><ul><li><p>Uváznutí nastane pouze pokud jsou splněny následující podmínky.</p><ol><li><p><strong>Vzájemné vyloučení:</strong> každý prostředek je buď přidělen právě
jednomu vláknu a nebo je volný (prostředek nemůže být sdílen
více vlákny).</p></li><li><p><strong>Podmínka neodnímatelnosti:</strong> prostředek, který byl již
přidělen nějakému vláknu, nemůže mu být násilím odebrán (musí
být dobrovolně uvolněn daným vláknem).</p></li><li><p><strong>Podmínka \&quot;drž a čekej\&quot;:</strong> vlákno, které má již přideleny
nějaké prostředky, může žádat o další prostředky (vlákno může
žádat o prostředky postupně).</p></li><li><p><strong>Podmínka kruhového čekání:</strong> musí existovat smyčka dvou nebo
více vláken, ve které každé vlákno čeká na prostředek přidelený
dalšímu vláknu ve smyčce.</p></li></ol></li><li><p>První tři podmínky jsou nutné ale ne dostačující <span class="math math-inline"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>  </mtext><mo>⟹</mo><mtext>  </mtext></mrow><annotation encoding="application/x-tex">\implies</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.549em;vertical-align:-0.024em"></span><span class="mspace" style="margin-right:0.2777777777777778em"></span><span class="mrel">⟹</span><span class="mspace" style="margin-right:0.2777777777777778em"></span></span></span></span></span> k
uváznutí může dojít. Poslední podmínka představuje samotné uváznutí.</p></li><li><p>Pokud aspon jedna z podmínek není splněna, nemůže dojít k uváznutí.</p></li></ul><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="uváznutí"></a>Uváznutí<a class="hash-link" href="#uváznutí" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="způsoby-řešení-uváznut"></a>Způsoby řešení uváznut<a class="hash-link" href="#způsoby-řešení-uváznut" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="pštrosí-algoritmus"></a>Pštrosí algoritmus<a class="hash-link" href="#pštrosí-algoritmus" title="Direct link to heading">#</a></h3><p>Úplné ignorování celého problému.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="detekce-a-zotavení"></a>Detekce a zotavení<a class="hash-link" href="#detekce-a-zotavení" title="Direct link to heading">#</a></h3><p>K uváznutí může dojít, ale pak je detekováno a odstraněno</p><p>Zotavení pomocí odebrání - násilné odebrání prostředku</p><p>Zotavení pomocí návratu - při detekci uváznutí je proces vrácen zpět v
čase</p><p>Zotavení pomocí ukončení procesů - ukončení procesu ze smyčky alokačního
grafu</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="pečlivá-alokace-prostředků"></a>Pečlivá alokace prostředků<a class="hash-link" href="#pečlivá-alokace-prostředků" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="prevence-pomocí-nesplnění-aspoň-jedné-z-coffmanových-podmínek"></a>Prevence pomocí nesplnění aspoň jedné z Coffmanových podmínek<a class="hash-link" href="#prevence-pomocí-nesplnění-aspoň-jedné-z-coffmanových-podmínek" title="Direct link to heading">#</a></h3><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="příklady"></a>Příklady<a class="hash-link" href="#příklady" title="Direct link to heading">#</a></h1><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="večeřící-filosofové"></a>Večeřící filosofové<a class="hash-link" href="#večeřící-filosofové" title="Direct link to heading">#</a></h2><p>Model vláken, které soutěží o výlučný přístup k omezenému počtu
prostředků.</p><p>N filozofů sedí kolem kulatého stolu a každý z nich buď přemýšlí nebo
jí. K jídlu potřebuje současně levou a pravou vidličku.</p><p>Řešení:</p><ul><li><p>Pomocí mutexu</p></li><li><p>Ověřovani že můžeme vzít obě vidličky (atomické)</p></li><li><p>Upozornění sousedů po skončení</p></li><li><p>Sousedi blokováni mutexem než dostanou upozornění</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="čtenáři---písaři"></a>Čtenáři - písaři<a class="hash-link" href="#čtenáři---písaři" title="Direct link to heading">#</a></h2><p>Model vláken, které přistupují do společné databáze.</p><p>Více čtenářů může číst současně data pokud žádný písař nemodifikuje data
v databázi.</p><p>Pouze jeden písař může modifikovat data v databázi v jednom okamžiku.</p><p>Řešení:</p><ul><li><p>Pomoc mutexu a counteru</p></li><li><p>Uzavírání DB při psaní</p></li><li><p>Reader čeká než může číst</p></li><li><p>Reader notifikuje writer když už nikdo nečte</p></li><li><p>Writer čeká než může psát</p></li><li><p>Writer notifikuje reader když už nepiše</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="producent---konzument"></a>Producent - konzument<a class="hash-link" href="#producent---konzument" title="Direct link to heading">#</a></h2><p><strong>Producent</strong> produkuje data a vkládá je do sdílené fronty s omezenou
kapacitou</p><p><strong>Konzument</strong> vybírá data ze sdílené fronty.</p><p>Řešení:</p><ul><li><p>Tři mutexy</p></li><li><p>Jeden pro prřístup do fronty</p></li><li><p>Jeden pro stav full (konzument čeká)</p></li><li><p>Jeden pro stav empty (producent čeká)</p></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col text--right"><em><small>Zpracoval <strong>Daniel Hampl</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/szz-bootcamp/topics/bi-spol-15/bi-spol-15"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« bi-spol-15</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/szz-bootcamp/topics/bi-spol-18/bi-spol-18"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">bi-spol-18 »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#procesy" class="table-of-contents__link">Procesy</a></li><li><a href="#vlákna" class="table-of-contents__link">Vlákna</a></li><li><a href="#zákaz-přerušení-di" class="table-of-contents__link">Zákaz přerušení (DI)</a><ul><li><a href="#nevýhody" class="table-of-contents__link">Nevýhody</a></li></ul></li><li><a href="#aktivní-čekání-vs-blokování" class="table-of-contents__link">Aktivní čekání vs blokování</a><ul><li><a href="#aktivní-čekání" class="table-of-contents__link">Aktivní čekání</a></li><li><a href="#blokování" class="table-of-contents__link">Blokování</a></li></ul></li><li><a href="#sdílená-proměnná" class="table-of-contents__link">Sdílená proměnná</a></li><li><a href="#instrukce-tsl" class="table-of-contents__link">Instrukce TSL</a></li><li><a href="#instrukce-xchg" class="table-of-contents__link">Instrukce XCHG</a></li><li><a href="#problémy" class="table-of-contents__link">Problémy</a><ul><li><a href="#bez-použití-synchronizace-časově-závislé-chyby" class="table-of-contents__link">Bez použití synchronizace (časově závislé chyby)</a></li><li><a href="#při-použití-synchronizace" class="table-of-contents__link">Při použití synchronizace</a></li><li><a href="#inverzní-prioritní-problém" class="table-of-contents__link">Inverzní prioritní problém</a></li><li><a href="#synchronizace-pomocí-blokování" class="table-of-contents__link">Synchronizace pomocí blokování</a></li></ul></li><li><a href="#typy-synchronizace" class="table-of-contents__link">Typy synchronizace</a></li><li><a href="#adresování" class="table-of-contents__link">Adresování</a></li><li><a href="#sleep--wakeup" class="table-of-contents__link">Sleep &amp; Wakeup</a><ul><li><a href="#wait" class="table-of-contents__link">wait()</a></li><li><a href="#wakeupthread" class="table-of-contents__link">wakeup(thread)</a></li></ul></li><li><a href="#condition-variable" class="table-of-contents__link">Condition variable</a><ul><li><a href="#cond_waitvar-mutex" class="table-of-contents__link">cond_wait(&amp;var, &amp;mutex)</a></li><li><a href="#cond_signalvar" class="table-of-contents__link">cond_signal(&amp;var)</a></li></ul></li><li><a href="#semafor" class="table-of-contents__link">Semafor</a></li><li><a href="#bariéry" class="table-of-contents__link">Bariéry</a></li><li><a href="#způsoby-řešení-uváznut" class="table-of-contents__link">Způsoby řešení uváznut</a><ul><li><a href="#pštrosí-algoritmus" class="table-of-contents__link">Pštrosí algoritmus</a></li><li><a href="#detekce-a-zotavení" class="table-of-contents__link">Detekce a zotavení</a></li><li><a href="#pečlivá-alokace-prostředků" class="table-of-contents__link">Pečlivá alokace prostředků</a></li><li><a href="#prevence-pomocí-nesplnění-aspoň-jedné-z-coffmanových-podmínek" class="table-of-contents__link">Prevence pomocí nesplnění aspoň jedné z Coffmanových podmínek</a></li></ul></li><li><a href="#večeřící-filosofové" class="table-of-contents__link">Večeřící filosofové</a></li><li><a href="#čtenáři---písaři" class="table-of-contents__link">Čtenáři - písaři</a></li><li><a href="#producent---konzument" class="table-of-contents__link">Producent - konzument</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 SZZ FIT CTU students. Built with Docusaurus.</div></div></div></footer></div>
<script src="/szz-bootcamp/styles.00aaecf6.js"></script>
<script src="/szz-bootcamp/runtime~main.52bf9769.js"></script>
<script src="/szz-bootcamp/main.22fd2fa4.js"></script>
<script src="/szz-bootcamp/1.07683b9e.js"></script>
<script src="/szz-bootcamp/2.fa753fda.js"></script>
<script src="/szz-bootcamp/69.d53fd8be.js"></script>
<script src="/szz-bootcamp/70.b0f0a915.js"></script>
<script src="/szz-bootcamp/935f2afb.dab50b01.js"></script>
<script src="/szz-bootcamp/17896441.303e14c5.js"></script>
<script src="/szz-bootcamp/77dc8558.215fe551.js"></script>
</body>
</html>